<div class="admin-dashboard">
    <div class="content-header">
        <h1>Admin Dashboard</h1>
    </div>

    <!-- Stats Cards -->
    <section class="stats-section">
        <div class="stat-card">
            <div class="stat-icon users">
                <mat-icon>people</mat-icon>
            </div>
            <div class="stat-info">
                <h3>{{ stats().totalUsers }}</h3>
                <p>Total Users</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon posts">
                <mat-icon>article</mat-icon>
            </div>
            <div class="stat-info">
                <h3>{{ stats().totalPosts || 0 }}</h3>
                <p>Total Posts</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon reports">
                <mat-icon>flag</mat-icon>
            </div>
            <div class="stat-info">
                <h3>{{ stats().totalReports || 0 }}</h3>
                <p>Reports</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon active">
                <mat-icon>verified_user</mat-icon>
            </div>
            <div class="stat-info">
                <h3>{{ stats().regularUsers }}</h3>
                <p>Regular Users</p>
            </div>
        </div>
    </section>

    <!-- Tabs Navigation -->
    <div class="tabs-container">
        <button class="tab-btn" [class.active]="activeTab() === 'users'" (click)="setActiveTab('users')">
            <mat-icon>people</mat-icon> <span>Users</span>
        </button>
        <button class="tab-btn" [class.active]="activeTab() === 'posts'" (click)="setActiveTab('posts')">
            <mat-icon>article</mat-icon> <span>Posts</span>
        </button>
        <button class="tab-btn" [class.active]="activeTab() === 'reports'" (click)="setActiveTab('reports')">
            <mat-icon>flag</mat-icon> <span>Reports</span>
        </button>
    </div>

    <!-- Users Tab Content -->
    <div class="tab-content" *ngIf="activeTab() === 'users'">
        <div class="users-table-container">
            <table>
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Joined</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let user of filteredUsers()">
                        <td>
                            <div class="user-cell">
                                <div class="user-avatar-circle">
                                    {{ user.username.charAt(0).toUpperCase() }}
                                </div>
                                <span class="username-link" [routerLink]="['/block', user.username]">{{ user.username
                                    }}</span>
                            </div>
                        </td>
                        <td>{{ user.email }}</td>
                        <td>
                            <span class="role-badge" [class.admin]="user.role === 'ADMIN'">
                                {{ user.role }}
                            </span>
                        </td>
                        <td>{{ formatDate(user.createdAt) }}</td>
                        <td>
                            <div class="action-buttons">
                                <button *ngIf="!user.banned" class="action-btn ban-btn"
                                    (click)="banUser(user.id, user.username)" [disabled]="user.role === 'ADMIN'">
                                    <mat-icon>block</mat-icon>
                                </button>
                                <button *ngIf="user.banned" class="action-btn unban-btn"
                                    (click)="unbanUser(user.id, user.username)" [disabled]="user.role === 'ADMIN'"
                                    title="Unban User">
                                    <mat-icon>check_circle</mat-icon>
                                </button>
                                <button class="action-btn delete-btn" (click)="deleteUser(user.id, user.username)"
                                    [disabled]="user.role === 'ADMIN'">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Posts Tab Content -->
    <div class="tab-content" *ngIf="activeTab() === 'posts'">
        <div class="users-table-container">
            <table>
                <thead>
                    <tr>
                        <th>Author</th>
                        <th>Title</th>
                        <th>Snippet</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let post of filteredPosts()">
                        <td>
                            <span class="username-link" [routerLink]="['/block', post.authorUsername]">
                                {{ post.authorUsername }}
                            </span>
                        </td>
                        <td>{{ post.title || 'Untitled' }}</td>
                        <td>{{ post.content | slice:0:50 }}{{ post.content.length > 50 ? '...' : '' }}</td>
                        <td>{{ formatDate(post.createdAt) }}</td>
                        <td>
                            <div class="action-buttons">
                                <button *ngIf="!post.hidden" class="action-btn ban-btn" (click)="hidePost(post.id)"
                                    title="Hide Post">
                                    <mat-icon>visibility_off</mat-icon>
                                </button>
                                <button *ngIf="post.hidden" class="action-btn unban-btn" (click)="unhidePost(post.id)"
                                    title="Unhide Post">
                                    <mat-icon>visibility</mat-icon>
                                </button>
                                <button class="action-btn delete-btn" (click)="deletePost(post.id)" title="Delete Post">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Reports Tab Content -->
    <div class="tab-content" *ngIf="activeTab() === 'reports'">
        <div class="users-table-container">
            <table>
                <thead>
                    <tr>
                        <th>Reported</th>
                        <th>Reason</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let report of filteredReports()">
                        <td>
                            <div (click)="navigateToReported(report)" class="username-link">
                                {{ report.reportedUsername }}
                                <span *ngIf="report.reportedPostId" class="post-id-hint">(Post #{{ report.reportedPostId
                                    }})</span>
                            </div>
                        </td>
                        <td>{{ report.reason }}</td>
                        <td>
                            <span class="status-badge" [class.pending]="report.status === 'PENDING'"
                                [class.resolved]="report.status === 'RESOLVED'"
                                [class.rejected]="report.status === 'REJECTED'">
                                {{ report.status }}
                            </span>
                        </td>
                        <td>{{ formatDate(report.createdAt) }}</td>
                        <td>
                            <div class="action-buttons" *ngIf="report.status === 'PENDING'">
                                <button class="action-btn resolve-btn" (click)="resolveReport(report.id)"
                                    title="Resolve">
                                    <mat-icon>check_circle</mat-icon>
                                </button>
                                <button class="action-btn reject-btn" (click)="rejectReport(report.id)" title="Reject">
                                    <mat-icon>cancel</mat-icon>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- Post View Modal -->
<div class="modal-backdrop" *ngIf="showPostModal()" (click)="closePostModal()">
    <div class="modal-content post-view-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Reported Post</h2>
            <button class="close-btn" (click)="closePostModal()">
                <mat-icon>close</mat-icon>
            </button>
        </div>
        <div class="modal-body" *ngIf="selectedPost() as post">
            <div class="post-preview-header">
                <div class="author-info">
                    <span class="author-name">{{ post.authorUsername }}</span>
                    <span class="post-date">{{ formatDate(post.createdAt) }}</span>
                </div>
            </div>
            <div class="post-preview-content">
                <h3 *ngIf="post.title">{{ post.title }}</h3>
                <p>{{ post.content }}</p>
                <div *ngIf="post.media && post.media.length > 0" class="post-media-grid"
                    [class.multiple]="post.media.length > 1">
                    <div *ngFor="let m of post.media" class="media-item">
                        <img *ngIf="m.mediaType === 'IMAGE'" [src]="m.mediaUrl">
                        <video *ngIf="m.mediaType === 'VIDEO'" [src]="m.mediaUrl" controls></video>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button *ngIf="!post.hidden" class="action-btn ban-btn" (click)="hidePost(post.id); closePostModal()">
                    <mat-icon>visibility_off</mat-icon> Hide Post
                </button>
                <button *ngIf="post.hidden" class="action-btn unban-btn"
                    (click)="unhidePost(post.id); closePostModal()">
                    <mat-icon>visibility</mat-icon> Unhide Post
                </button>
                <button class="action-btn delete-btn-large" (click)="deletePost(post.id); closePostModal()">
                    <mat-icon>delete</mat-icon> Delete Post
                </button>
                <button class="action-btn close-modal-btn" (click)="closePostModal()">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<app-confirm-modal *ngIf="showConfirmModal()" [title]="confirmModalTitle()" [message]="confirmModalMessage()"
    (confirm)="onConfirmAction()" (cancel)="onCancelConfirm()">
</app-confirm-modal>
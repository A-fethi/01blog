<!-- Loading Overlay -->
<div class="loading-overlay" *ngIf="authService.isLoading()">
    <div class="loading-spinner">
        <mat-icon class="spinner-icon">refresh</mat-icon>
        <p>Loading...</p>
    </div>
</div>

<!-- Main Content -->
<div class="main-content" *ngIf="!authService.isLoading()">
    <!-- Top Navigation Bar -->
    <header class="top-nav">
        <div class="nav-left">
            <div class="logo">01</div>
            <div class="search-bar">
                <i class="icon"><mat-icon>search</mat-icon></i>
                <input type="text" placeholder="Search 01Blog">
            </div>
        </div>

        <div class="nav-center">
            <a routerLink="/home" class="nav-tab" routerLinkActive="active" title="Feed">
                <i class="icon"><mat-icon>home</mat-icon></i>
            </a>
            <a routerLink="/notifications" class="nav-tab" routerLinkActive="active" title="Notifications"
                *ngIf="authService.isLoggedIn()">
                <i class="icon"><mat-icon>notifications</mat-icon></i>
            </a>
        </div>

        <div class="nav-right">
            <!-- Logged-in: avatar icon + dropdown -->
            <button class="user-menu-btn" *ngIf="authService.isLoggedIn(); else loggedOutButton"
                (click)="onProfileClick()">
                <mat-icon>account_box</mat-icon>
            </button>

            <!-- Not logged in: Login / Sign up button -->
            <ng-template #loggedOutButton>
                <button class="user-menu-btn" (click)="onProfileClick()">
                    <mat-icon>login</mat-icon>
                </button>
            </ng-template>

            <!-- User menu panel (only when logged in) -->
            <div class="user-menu-panel" *ngIf="authService.isLoggedIn() && showUserMenu()">
                <button class="user-menu-item" [routerLink]="['/block']">My Block</button>
                <button class="user-menu-item" (click)="onLogout()">Logout</button>
            </div>
        </div>
    </header>

    <div class="main-layout">
        <!-- Left Sidebar: Navigation & Profile -->
        <aside class="sidebar left-sidebar">
            <div class="profile-card">
                <img *ngIf="currentUser().avatarUrl" [src]="currentUser().avatarUrl" class="profile-avatar">
                <div *ngIf="!currentUser().avatarUrl" class="profile-avatar"
                    style="background: #e0e0e0; display: flex; align-items: center; justify-content: center;">
                    <mat-icon>account_circle</mat-icon>
                </div>
                <div class="profile-info">
                    <h3>{{currentUser().name}}</h3>
                    <p>{{currentUser().handle}}</p>
                </div>
            </div>

            <nav class="main-nav">
                <a routerLink="/home" class="nav-item" routerLinkActive="active">
                    <i class="icon"><mat-icon>home</mat-icon></i> Feed
                </a>
                <a routerLink="/block" class="nav-item" routerLinkActive="active">
                    <i class="icon"><mat-icon>account_circle</mat-icon></i> My Block
                </a>
                <a href="#" class="nav-item">
                    <i class="icon"><mat-icon>diversity_3</mat-icon></i> Subscriptions
                </a>
                <a routerLink="/admin" class="nav-item admin-link"
                    *ngIf="authService.isLoggedIn() && authService.isAdmin()" routerLinkActive="active">
                    <i class="icon"><mat-icon>admin_panel_settings</mat-icon></i> Admin Panel
                </a>
            </nav>
        </aside>

        <!-- Center Column: Dynamic Content -->
        <main class="feed-container">
            <router-outlet></router-outlet>
        </main>

        <!-- Right Sidebar: Suggestions -->
        <aside class="sidebar right-sidebar">
            <div class="suggestions-container">
                <h3>Who to follow</h3>
                <div class="suggestion-list">
                    <div class="suggestion-item">
                        <p>Suggestions coming soon...</p>
                    </div>
                </div>
            </div>
        </aside>
    </div>
</div>